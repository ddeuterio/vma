# VMA - Vulnerability Management Application

A comprehensive vulnerability management platform for tracking CVEs across container images, with support for both SCA (Software Composition Analysis) and SAST (Static Application Security Testing) findings.

## Features

### Vulnerability Data Sources

- **NVD Integration** - Sync CVE data from NIST National Vulnerability Database
- **OSV Integration** - Import vulnerabilities from the Open Source Vulnerabilities database
- **Scanner Support** - Import results from Grype (SCA) and Semgrep (SAST)

### Core Capabilities

- **Product & Image Management** - Organize vulnerabilities by products and container image versions
- **Image Version Comparison** - Compare vulnerabilities between different versions of the same image
- **Team-Based Access Control** - Hierarchical permissions (READ_ONLY, WRITE, ADMIN) per team
- **CVSS & EPSS Scoring** - View multiple CVSS versions and EPSS probability scores
- **Rich Vulnerability Details** - CWEs, fix versions, references, and related vulnerabilities

### Security

- **JWT Authentication** - Short-lived access tokens with automatic refresh
- **API Tokens** - Long-lived tokens for CI/CD and programmatic access
- **Argon2 Password Hashing** - Industry-standard secure password storage
- **Role-Based Authorization** - Fine-grained team and scope permissions

## Quick Start

### Prerequisites

- Docker & Docker Compose
- (Optional) NVD API key for faster CVE sync

### Installation

1. **Clone the repository**

   ```bash
   git clone https://github.com/yourusername/vma.git
   cd vma
   ```

2. **Create environment file**

   Create `.env` in the `docker/` directory:

   ```bash
   # Database
   DB_HOST=db
   DB_USER=vma
   DB_PASS=your_secure_password
   DB_NAME=vma
   POSTGRES_USER=vma
   POSTGRES_PASSWORD=your_secure_password
   POSTGRES_DB=vma

   # NVD API (optional but recommended)
   NVD_API_KEY=your_nvd_api_key

   # JWT Secrets (generate secure random strings)
   SECRET_KEY_ACCESS=your_access_secret_key
   SECRET_KEY_REFRESH=your_refresh_secret_key
   TOKEN_ALG=HS256
   ACCESS_TOKEN_EXP_TIME=15
   REFRESH_TOKEN_EXP_TIME=2
   ```

3. **Build Docker images**

   ```bash
   docker build -t vma:latest -f Dockerfile.vma .
   docker build -t web:latest -f Dockerfile.web .
   ```

4. **Start the stack**

   ```bash
   cd docker
   docker-compose up -d
   ```

5. **Initialize the database**

   ```bash
   # Create admin user
   docker exec -it vma-web vma login --init

   # Initialize CVE database (takes several hours on first run)
   docker run --rm --env-file .env vma cve --init
   ```

6. **Access the application**

   Add to `/etc/hosts`:

   ```
   127.0.0.1 vma.local
   ```

   Navigate to: `https://vma.local:8443`

   Default credentials: `admin@vma.com` / `changeme`

## CLI Reference

### CVE Database Management

```bash
# Initialize NVD database (full historical sync)
vma cve --init

# Update with recent CVE changes
vma cve --update
```

### OSV Database Management

```bash
# Download and process all OSV data
vma osv --all

# Process only recent updates
vma osv --recent
```

### Import Scan Results

```bash
# Import Grype SCA results
vma import \
  --type grype \
  --file scan-results.json \
  --product my-product \
  --image my-app \
  --version 1.0.0 \
  --team engineering \
  --host localhost \
  --port 8000 \
  --token your_api_token \
  --secure \
  --ignore-cert
```

## Technology Stack

| Component | Technology |
|-----------|------------|
| Backend | FastAPI, Python 3.10+ |
| Database | PostgreSQL 13+ |
| Authentication | JWT, Argon2 |
| Frontend | Vanilla JavaScript, CSS |
| Server | Gunicorn + Uvicorn |
| Reverse Proxy | Nginx |
| Container | Docker |

## Documentation

Comprehensive documentation is available in the `docs/` directory:

- [User Guide](docs/user-guide.md) - How to use VMA
- [Architecture](docs/architecture.md) - System design and components
- [API Reference](docs/api-reference.md) - Complete API documentation
- [CLI Reference](docs/cli-reference.md) - Command-line usage
- [Contributing](docs/contributing.md) - Development guidelines

## Tests

Tests have been generated by Claude. Those tests are not meant to be as accurate as possible but a placeholder to have in for the CI in GH Actions.

## License

This project is licensed under the **Apache License 2.0 with Commons Clause**.

**What this means:**

- **Free to use** for personal, educational, and internal business purposes
- **Free to modify** and create derivative works
- **Free to distribute** with proper attribution
- **Cannot be sold** as a product or service (see Commons Clause restriction)

**Commercial Use Restriction:**
You cannot provide VMA to third parties as a commercial offering (SaaS, hosting, consulting) where the value derives substantially from VMA's functionality.

For commercial licensing inquiries: <daniel.garcia.anes@gmail.com>

See [LICENSE.txt](LICENSE.txt) for full terms and conditions.

## Contributing

Contributions are welcome! Please read the [contributing guidelines](docs/contributing.md) before submitting pull requests.

## Author

**Daniel Garcia** - <daniel.garcia.anes@gmail.com>
